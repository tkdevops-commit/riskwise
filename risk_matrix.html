<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Social Risk Management Matrix</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 30px;
      background: #f9f9f9;
    }

    h2 {
      text-align: center;
    }

    .cell {
      stroke: #999;
      stroke-width: 1px;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .cell:hover {
      transform: scale(1.05);
      stroke-width: 2px;
    }

    .label {
      font-weight: bold;
      text-anchor: middle;
    }

    .matrix-label {
      font-size: 14px;
      font-weight: bold;
    }

    .tooltip {
      position: absolute;
      text-align: center;
      padding: 6px;
      font-size: 13px;
      background: rgba(0,0,0,0.7);
      color: #fff;
      border-radius: 5px;
      pointer-events: none;
    }
  </style>
</head>
<body>
  <h2>Social Risk Management Matrix</h2>
  <svg id="riskMatrix" width="700" height="550"></svg>

  <script>
    // Axes
    const severity = [
      'Minor Discontent',
      'Disengagement',
      'Internal Friction',
      'Reputational Damage',
      'Systemic Breakdown'
    ];
    const likelihood = ['Rare', 'Unlikely', 'Possible', 'Likely', 'Imminent'];

    // 5x5 Matrix - risk scoring
    const riskMatrix = [
      [1, 2, 3, 4, 5],
      [2, 4, 6, 8, 10],
      [3, 6, 9, 12, 15],
      [4, 8, 12, 16, 20],
      [5, 10, 15, 20, 25]
    ];

    const width = 500, height = 500;
    const cellSize = width / severity.length;

    const svg = d3.select("#riskMatrix")
      .attr("width", width + 150)
      .attr("height", height + 100);

    // Tooltip
    const tooltip = d3.select("body")
      .append("div")
      .attr("class", "tooltip")
      .style("opacity", 0);

    // Color scale for low-high risk
    const color = d3.scaleThreshold()
      .domain([5, 10, 15, 20, 25])
      .range(["#d4f7dc", "#fefcbf", "#fed7aa", "#fca5a5", "#b91c1c"]);

    // Explanations for tooltips
    const explanations = {
      1: "Stable environment – low social tension.",
      5: "Emerging signs of disengagement or gossip.",
      10: "Moderate mistrust forming between groups.",
      15: "High tension – potential morale breakdown.",
      20: "Reputational risk – public exposure likely.",
      25: "Systemic cultural failure – urgent intervention required."
    };

    // Draw cells
    svg.selectAll("rect.cell")
      .data(riskMatrix.flat())
      .enter()
      .append("rect")
      .attr("class", "cell")
      .attr("x", (d, i) => (i % 5) * cellSize + 120)
      .attr("y", (d, i) => Math.floor(i / 5) * cellSize + 40)
      .attr("width", cellSize)
      .attr("height", cellSize)
      .attr("fill", d => color(d))
      .on("mouseover", function(event, d) {
        tooltip.transition().duration(200).style("opacity", 1);
        tooltip.html(`<strong>Score:</strong> ${d}<br>${explanations[d] || 'Review required.'}`)
          .style("left", (event.pageX + 10) + "px")
          .style("top", (event.pageY - 28) + "px");
      })
      .on("mouseout", function() {
        tooltip.transition().duration(300).style("opacity", 0);
      });

    // Add cell text (score numbers)
    svg.selectAll("text.cell-text")
      .data(riskMatrix.flat())
      .enter()
      .append("text")
      .attr("class", "cell-text")
      .attr("x", (d, i) => (i % 5) * cellSize + 120 + cellSize / 2)
      .attr("y", (d, i) => Math.floor(i / 5) * cellSize + 40 + cellSize / 2 + 5)
      .attr("text-anchor", "middle")
      .attr("fill", "#000")
      .text(d => d);

    // Add x-axis labels (severity)
    severity.forEach((label, i) => {
      svg.append("text")
        .attr("class", "matrix-label")
        .attr("x", i * cellSize + 120 + cellSize / 2)
        .attr("y", 30)
        .attr("text-anchor", "middle")
        .text(label);
    });

    // Add y-axis labels (likelihood)
    likelihood.forEach((label, i) => {
      svg.append("text")
        .attr("class", "matrix-label")
        .attr("x", 110)
        .attr("y", i * cellSize + 40 + cellSize / 2 + 5)
        .attr("text-anchor", "end")
        .text(label);
    });

    // Axis titles
    svg.append("text")
      .attr("x", width / 2 + 120)
      .attr("y", height + 70)
      .attr("text-anchor", "middle")
      .style("font-weight", "bold")
      .text("Severity of Social Impact");

    svg.append("text")
      .attr("transform", `translate(40,${height / 2 + 40}) rotate(-90)`)
      .attr("text-anchor", "middle")
      .style("font-weight", "bold")
      .text("Likelihood of Occurrence");
  </script>
</body>
</html>
